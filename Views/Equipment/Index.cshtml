@using System.Web.Optimization
@using X.PagedList
@using X.PagedList.Mvc
@using X.PagedList.Mvc.Core
@using X.PagedList.Mvc.Common
@model SearchEquipmentViewModel
@{
    ViewData["Title"] = "Index";
}
@section stylesheet {
    <link href="~/lib/bootstrap-table/dist/bootstrap-table.min.css" media="all" rel="stylesheet" type="text/css"/>
}
<div class="bodyinfo">
    <div class="row pt-3 d-flex align-items-center">
        <a asp-action="New" class="btn btn-primary">新建</a>
        <form asp-controller="Equipment" asp-action="Index" asp-route-returnurl="@ViewData["ReturnUrl"]" method="get" class="form-inline" role="form" style="padding: 0; margin:0">
        <div class="form-group ml-4">
            <div class="input-group">
                <input type="text" name="kw" value="@Model.Kw" class="form-control" placeholder="设备或code" aria-label="设备或code" aria-describedby="button-addon2">
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="submit" id="button-addon2">搜索</button>
                </div>
            </div>
        </div>
        </form>
    </div>
    <div class="row pt-3">
        <nav aria-label="Page navigation" class="flex-grow-1 d-flex justify-content-center">
            @Html.PagedListPager((IPagedList)Model?.Equipments, 
                page => Url.Action("Index", new SearchEquipmentViewModel{ CurrentPage = page, PageSize = @Model.PageSize, Kw = @Model.Kw }), 
                new PagedListRenderOptions {
                    LiElementClasses = new string[] { "page-item" },
                    PageClasses = new string[] { "page-link" }
                }
            )
        </nav>
    </div>

    <div class="row pt-3" style="padding-bottom:40px;">
        <table class="table" data-toggle="table" data-classes="table">
            <thead>
                <tr>
                    <th></th>
                    <th data-field="Name" data-sortable="true" class="sortClass">
                        @Html.DisplayNameFor(model => Model.Equipments.First().Name)
                    </th>
                    <th data-field="Code" data-sortable="true">
                        @Html.DisplayNameFor(model => Model.Equipments.First().Code)
                    </th>
                    <th data-field="DealPrice" data-sortable="true">
                        @Html.DisplayNameFor(model => Model.Equipments.First().DealPrice)
                    </th>
                    <th data-field="AuctionHouse" data-sortable="true">
                        @Html.DisplayNameFor(model => Model.Equipments.First().AuctionHouse)
                    </th>
                    <th data-field="Manufacturer" data-sortable="true">
                        @Html.DisplayNameFor(model => Model.Equipments.First().Manufacturer)
                    </th>
                    <th data-field="Model" data-sortable="true">
                        @Html.DisplayNameFor(model => Model.Equipments.First().Model)
                    </th>
                    <th data-field="ProductionDate" data-sortable="true">
                        @Html.DisplayNameFor(model => Model.Equipments.First().ProductionDate)
                    </th>
                    <th data-field="WorkingTime" data-sortable="true">
                        @Html.DisplayNameFor(model => Model.Equipments.First().WorkingTime)
                    </th>
                    <th data-field="IsDeleted" data-sortable="true">
                        @Html.DisplayNameFor(model => Model.Equipments.First().IsDeleted)
                    </th>
                    <th style="min-width: 85px;">操作</th>
                </tr>
            </thead>
            <tbody>
                @foreach (EquipmentViewModel item in Model?.Equipments)
                {
                    <tr id="@item.Id">
                        <td>
                            <img src="@item.CoverPhoto?.RequestPath" width="80px">
                        </td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@item.Id" 
                                class="edit_link">@Html.DisplayFor(modelItem => item.Name)</a>
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Code)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.DealPrice)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.AuctionHouse)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Manufacturer)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Model)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.ProductionDate)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.WorkingTime)
                        </td>
                        <td class="isDeleted">
                            @Html.DisplayFor(modelItem => item.IsDeleted)
                        </td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@item.Id" class="fa fa-remove fa-lg" style="color: green">
                                <i class="fas fa-edit"></i>
                            </a>
                            <form asp-action="Delete" asp-route-id="@item.Id"
                                data-ajax="true" data-ajax-confirm="确认删除 @item.Name 吗?" 
                                data-ajax-success="deleteItem(this)" class="d-inline">
                                <button type="submit" class="fa fa-remove fa-lg link" 
                                    style="color: red; border: none; background: none;">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
       
        <nav aria-label="Page navigation example" class="flex-grow-1 d-flex justify-content-center">
             @Html.PagedListPager((IPagedList)Model?.Equipments, 
                page => Url.Action("Index", new SearchEquipmentViewModel{ CurrentPage = page, PageSize = @Model.PageSize, Kw = @Model.Kw }), 
                new PagedListRenderOptions {
                    LiElementClasses = new string[] { "page-item" },
                    PageClasses = new string[] { "page-link" }
            })
        </nav>
    </div>
</div>


@section Scripts {
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
    <script src="~/lib/bootstrap-table/dist/bootstrap-table.min.js"></script>
    <script src="~/lib/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js"></script>
    <script>

        function deleteItem(form) {
            $(form).closest("tr").find(".isDeleted").text("Yes");
        }
    </script>
}